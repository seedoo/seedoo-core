<?xml version="1.0" encoding="UTF-8"?>
<!-- This file is part of Seedoo.  The COPYRIGHT file at the top level of
this module contains the full copyright notices and license terms. -->

<openerp>
    <data>

        <template id="protocollo-accordion" name="seedoo_protocollo assets" inherit_id="web.assets_backend">
            <xpath expr="." position="inside">
                <link rel="stylesheet" href="/seedoo_protocollo/static/src/css/protocollo.css"/>
                <link rel="stylesheet" href="/seedoo_protocollo/static/src/css/protocollo_accordion.css"/>
                <script type="text/javascript" src="/seedoo_protocollo/static/src/js/protocollo_accordion.js"/>
                <script type="text/javascript" src="/seedoo_protocollo/static/src/js/protocollo_patch.js"/>
            </xpath>
        </template>

        <!-- Typology -->

        <record model='ir.ui.view' id='protocollo_typology_form'>
            <field name="name">protocollo.typology.form</field>
            <field name="model">protocollo.typology</field>
            <field name="arch" type="xml">
                <form string="Tipologia" version="7.0">
                    <sheet>
                        <group col="4">
                            <group col="2">
                                <field name="name"/>
                                <field name="active"/>
                                <field name="display_order"/>
                                <field name="pec" string="Integrazione PEC"/>
                                <field name="sharedmail" string="Integrazione Shared Mail"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_typology_tree'>
            <field name="name">protocollo.typology.tree</field>
            <field name="model">protocollo.typology</field>
            <field name="arch" type="xml">
                <tree string="Tipologie">
                    <field name="name"/>
                    <field name="active"/>
                    <field name="pec" string="Integrazione PEC"/>
                    <field name="sharedmail" string="Integrazione Shared Mail"/>
                    <field name="display_order"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_typology_tree_selection'>
            <field name="name">protocollo.typology.tree.selection</field>
            <field name="model">protocollo.typology</field>
            <field name="arch" type="xml">
                <tree string="Tipologie">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_typology_search'>
            <field name="name">protocollo.typology.search</field>
            <field name="model">protocollo.typology</field>
            <field name="arch" type="xml">
                <search string="Tipologie">
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record model='ir.actions.act_window' id='protocollo_typology_act'>
            <field name="name">Mezzo Trasmissione</field>
            <field name="res_model">protocollo.typology</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Premi qui per creare un nuovo record
                </p>
                <p>
                    Ricordati di inserire tutti i campi in celeste!
                </p>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_dossier_form'>
            <field name="name">protocollo.dossier.form</field>
            <field name="model">protocollo.dossier</field>
            <field name="inherit_id" ref="seedoo_gedoc.protocollo_dossier_form"/>
            <field name="arch" type="xml">
                <page string="Documenti" position="before">
                    <page string="Documenti Protocollati" >
                        <field name="protocollo_ids" nolabel="1" options="{'no_create': True, 'no_create_edit': True}"/>
                        <newline/>
                    </page>
                </page>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_classification_tree'>
            <field name="name">protocollo.classification.tree</field>
            <field name="model">protocollo.classification</field>
            <field name="field_parent">child_ids</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <tree string="Titolario" default_order="sequence">
                    <field name="sequence" invisible="1"/>
                    <field name="code"/>
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_classification_tree2'>
            <field name="name">protocollo.classification.tree</field>
            <field name="model">protocollo.classification</field>
            <field name="priority" eval="10"/>
            <field name="arch" type="xml">
                <tree string="Titolario">
                    <field name="sequence" widget="handle"/>
                    <field name="sequence"/>
                    <field name="complete_name"/>
                    <field name="parent_id"/>
                </tree>
            </field>
        </record>

        <!--
        <record model='ir.ui.view' id='protocollo_classification_search'>
            <field name="name">protocollo.classification.search</field>
            <field name="model">protocollo.classification</field>
            <field name="arch" type="xml">
                <search string="Titolario">
                    <field name="code"/>
                    <field name="sequence"/>
                    <field name="complete_name"/>
                    <field name="parent_id"/>
                </search>
            </field>
        </record>
        -->

        <record model="ir.actions.act_window" id="protocollo_classification_act">
            <field name="name">Titolario</field>
            <field name="res_model">protocollo.classification</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="protocollo_classification_tree"/>
            <field name="domain">[('parent_id','=',False)]</field>
            <field name="context">{'order_sequence':True}</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_classification_def_act">
            <field name="name">Titolario</field>
            <field name="res_model">protocollo.classification</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Premi qui per creare un nuovo record
                </p>
                <p>
                    Ricordati di inserire tutti i campi in celeste!
                </p>
            </field>
        </record>

        <record model="ir.actions.act_window.view" id="protocollo_classification_def_act_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="protocollo_classification_tree2"/>
            <field name="act_window_id" ref="protocollo_classification_def_act"/>
        </record>

        <record model="ir.actions.act_window.view" id="protocollo_classification_def_act_form">
            <field name="sequence" eval="1"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="seedoo_gedoc.protocollo_classification_form"/>
            <field name="act_window_id" ref="protocollo_classification_def_act"/>
        </record>


        <!-- Registry -->

        <record model='ir.ui.view' id='protocollo_registry_form'>
            <field name="name">protocollo.registry.form</field>
            <field name="model">protocollo.registry</field>
            <field name="arch" type="xml">
                <form string="Registro" create="0" version="7.0">
                    <sheet>
                        <group col="4">
                            <field name="name"/>
                            <field name="code"/>
                            <field name="sequence"/>
                            <field name="priority"/>
                            <field name="company_id"/>
                            <newline/>
                            <field name="description" colspan="4"/>
                            <!--<field name="office_ids" colspan="4"/>-->
                            <field name="first_aoo_id" colspan="4" invisible="1"/>
                            <field name="allowed_employee_ids" colspan="4" domain="[('department_id.aoo_id', '=', first_aoo_id)]"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_registry_tree'>
            <field name="name">protocollo.registry.tree</field>
            <field name="model">protocollo.registry</field>
            <field name="arch" type="xml">
                <tree string="Registri" create="0">
                    <field name="name"/>
                    <field name="code"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_registry_search'>
            <field name="name">protocollo.registry.search</field>
            <field name="model">protocollo.registry</field>
            <field name="arch" type="xml">
                <search string="Registri">
                    <field name="name"/>
                    <field name="code"/>
                </search>
            </field>
        </record>

        <record model='ir.actions.act_window' id='protocollo_registry_act'>
            <field name="name">Registro Ufficiale</field>
            <field name="res_model">protocollo.registry</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


        <record model='ir.actions.act_window' id='protocollo_dossier_read_act'>
            <field name="name">Fascicoli</field>
            <field name="res_model">protocollo.dossier</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="seedoo_gedoc.protocollo_dossier_tree"/>
        </record>


        <!-- Protocollo -->

        <record model='ir.ui.view' id='protocollo_protocollo_form'>
            <field name="name">protocollo.protocollo.form</field>
            <field name="model">protocollo.protocollo</field>
            <field name="arch" type="xml">
                <form string="Protocollo" create="0" version="7.0">
                    <header>
                        <button name="%(protocollo_registration_confirmation_action)d" string="Registra Protocollo" type="action"
                                attrs="{'invisible':[('registra_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_registra_protocollo oe_read_only"/>

                        <button name="%(protocollo_cancel_action)d" string="Annulla Protocollo" type="action"
                                attrs="{'invisible':[('annulla_visibility','=',False)]}"
                                class="oe_highlight_warning btn_seedoo btn_annulla_protocollo"/>

                        <button string="Prendi in Carico"
                                type="object" name="prendi_in_carico"
                                attrs="{'invisible':[('prendi_in_carico_visibility','=',False)]}"
                                class="oe_highlight btn_seedoo btn_presa_in_carico"/>

                        <button name="%(protocollo_rifiuta_action)d" string="Rifiuta Assegnazione" type="action"
                                attrs="{'invisible':[('rifiuta_visibility','=',False)]}"
                                class="oe_highlight_warning btn_seedoo btn_rifiuta_presa_in_carico"/>

                        <button string="Segna come letto"
                                type="object" name="segna_come_letto"
                                attrs="{'invisible':[('segna_come_letto_visibility','=',False)]}"
                                class="oe_highlight btn_seedoo btn_presa_in_carico"/>

                        <button name="%(protocollo_agli_atti_action)d" string="Agli Atti" type="action"
                                attrs="{'invisible':[('agli_atti_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_agli_atti"/>

                        <button name="%(protocollo_aggiungi_classificazione_action)d" string="Classifica" type="action"
                                attrs="{'invisible':[('classifica_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_classifica"/>

                        <button name="%(protocollo_aggiungi_fascicolazione_action)d" type="action" string="Fascicola"
                                attrs="{'invisible':[('fascicola_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_fascicola"/>

                        <button name="%(protocollo_aggiungi_assegnatari_action)d" string="Assegna" type="action"
                                attrs="{'invisible':[('assegna_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_assegna"/>

                        <button name="%(protocollo_riassegna_action)d" string="Riassegna" type="action" id="btn_riassegna"
                                attrs="{'invisible':[('riassegna_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_assegna"/>

                        <button name="sent_mail_pec" string="Invia PEC Protocollo"
                                attrs="{'invisible':[('invio_pec_visibility','=',False)]}"
                                class="oe_highlight btn_seedoo btn_invia_pec"/>

                        <button name="%(protocollo_modify_pec_action)d" string="Modifica Destinatari PEC" type="action"
                                attrs="{'invisible':[('modifica_pec_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_modifica_protocollo"/>

                        <button name="%(protocollo_modify_email_action)d" string="Modifica Destinatari E-mail" type="action"
                                attrs="{'invisible':[('modifica_email_visibility','=',False)]}"
                                class="oe_highlight_positive btn_seedoo btn_modifica_protocollo"/>

                        <button name="sent_mail_pec" string="Invia Mail Protocollo"
                                attrs="{'invisible':[('invio_sharedmail_visibility','=',False)]}"
                                class="oe_highlight btn_seedoo btn_invia_pec"/>

                        <!--<button name="aggiungi_destinatari_pec" string="Aggiungi - Destinatario" type="object"-->
                                <!--attrs="{'invisible':[('aggiungi_pec_visibility','=',False)]}"-->
                                <!--class="oe_highlight_positive btn_seedoo btn_aggiungi_destinatario" context="{'is_add_pec_receiver': True}"/>-->

                        <button name="sent" string="Invia Protocollo"
                                attrs="{'invisible':[('invio_protocollo_visibility','=',False)]}"
                                class="oe_highlight btn_seedoo btn_invia_protocollo"  />

                        <field name="state" widget="statusbar"
                               statusbar_colors='{"draft":"blue","notified":"green","registered":"notified", "sent":"green","error":"red","canceled":"red"}'
                               options="{'visible': 'registered'}"/>
                    </header>

                    <sheet>
                        <div invisible="1">
                            <field name="id"/>
                            <field name="registra_visibility"/>
                            <field name="annulla_visibility"/>
                            <field name="prendi_in_carico_visibility"/>
                            <field name="rifiuta_visibility"/>
                            <field name="segna_come_letto_visibility"/>
                            <field name="agli_atti_visibility"/>
                            <field name="modifica_dati_generali_visibility"/>
                            <field name="aggiungi_mittenti_visibility"/>
                            <field name="modifica_mittenti_visibility"/>
                            <field name="aggiungi_destinatari_visibility"/>
                            <field name="modifica_destinatari_visibility"/>
                            <field name="aggiungi_mittente_interno_visibility"/>
                            <field name="modifica_mittente_interno_visibility"/>
                            <field name="aggiungi_classificazione_visibility"/>
                            <field name="modifica_classificazione_visibility"/>
                            <field name="classifica_visibility"/>
                            <field name="aggiungi_fascicolazione_visibility"/>
                            <field name="modifica_fascicolazione_visibility"/>
                            <field name="fascicola_visibility"/>
                            <field name="aggiungi_assegnatari_visibility"/>
                            <field name="modifica_assegnatari_visibility"/>
                            <field name="aggiungi_assegnatari_cc_visibility"/>
                            <field name="assegna_visibility"/>
                            <field name="riassegna_visibility"/>
                            <field name="invio_pec_visibility"/>
                            <field name="invio_sharedmail_visibility"/>
                            <field name="invio_protocollo_visibility"/>
                            <field name="modifica_pec_visibility"/>
                            <field name="modifica_email_visibility"/>
                            <!--<field name="aggiungi_pec_visibility"/>-->
                            <field name="protocollazione_riservata_visibility"/>
                            <field name="carica_documento_visibility"/>
                            <field name="modifica_documento_visibility"/>
                            <field name="carica_allegati_visibility"/>
                            <field name="inserisci_testo_mailpec_visibility"/>
                            <field name="protocollo_fields_editability"/>
                            <field name="server_sharedmail_id_required"/>
                            <field name="server_pec_id_required"/>
                            <field name="doc_id" invisible="1"/>
                            <field name="doc_fname" invisible="1"/>
                            <field name="pec" colspan="2" invisible="1"/>
                            <field name="sharedmail" colspan="2" invisible="1"/>
                            <field name="creation_date" class="seedoocustom_protocollo_creation_date" invisible="1"/>
                            <field name="registration_type" invisible="1"/>
                            <field name="emergency_active" invisible="1"/>
                            <field name="registration_employee_department_id_readonly" invisible="1"/>
                            <field name="mail_pec_ref"/>
                            <field name="typology_editability"/>
                        </div>
                        <!--<div id="stato-protocollo">-->
                            <!--<field name="state" invisible="1"/>-->
                        <!--</div>-->
                        <div id="protocollo-accordion">
                            <div class="dati-protocollo-container" id="protocollo-container">
                                <div class="protocollo-accordion-toggle open">
                                    <h4 class="accordion-toggle">Protocollo</h4>
                                </div>
                                <div class="accordion-content accordion-open">
                                    <group col="8">
                                        <group>
                                            <field name="name"/>
                                            <field name="registration_date"/>
                                            <field name="registration_employee_name" readonly="1"/>
                                            <field name="registration_employee_department_name" string="Ufficio" readonly="1" attrs="{'invisible':[('state','=','draft'), ('registration_employee_department_id_readonly','=',False)]}"/>
                                            <field name="registration_employee_department_id" on_change="on_change_registration_employee_department(registration_employee_department_id)"
                                                   domain="[('can_used_to_protocol', '=', True)]"
                                                   widget="selection"
                                                   required="1"
                                                   attrs="{'readonly':[('registration_employee_department_id_readonly','=',True)], 'invisible':['|', ('registration_employee_department_id_readonly','=',True), ('state','!=','draft')]}"
                                            />
                                        </group>
                                        <group>
                                            <field name="aoo_id" options="{'no_open': True}" readonly="1"/>
                                            <field name="archivio_id" options="{'no_open': True}" readonly="1"/>
                                            <field name="registry" options="{'no_open': True}"/>
                                            <field name="type"/>
                                            <field name="reserved" attrs="{'invisible':[('protocollazione_riservata_visibility','=',False)], 'readonly':[('protocollo_fields_editability','=',False)]}"/>
                                            <field name="is_current_archive" invisible="1"/>
                                        </group>
                                    </group>
                                </div>
                            </div>
                            <div class="dati-protocollo-container" id="emergenza-container" attrs="{'invisible':[('registration_type','=', 'normal')]}">
                                <div class="protocollo-accordion-toggle open">
                                    <h4 class="accordion-toggle">Dati Protocollazione Emergenza</h4>
                                </div>
                                <div class="accordion-content accordion-open">
                                    <group col="8">
                                        <field name="emergency_protocol"
                                               attrs="{'required':[('registration_type','=','emergency')]}"/>
                                        <field name="emergency_receiving_date"
                                               attrs="{'required':[('registration_type','=','emergency')]}"
                                               on_change="on_change_emergency_receiving_date(emergency_receiving_date)"/>
                                    </group>
                                </div>
                            </div>

                            <div class="dati-protocollo-container" id="mittente-container" attrs="{'invisible':[('type','!=','in')]}">
                                <div class="protocollo-accordion-toggle">
                                    <h4 class="accordion-toggle">Protocollo Mittente</h4>
                                </div>
                                <div class="accordion-content">
                                    <newline/>
                                    <group col="4">
                                        <group>
                                            <field name="sender_registration_date"
                                                   attrs="{'invisible':[('type','!=','in')],'readonly':[('protocollo_fields_editability','=',False)]}"/>
                                            <newline/>
                                            <field name="sender_protocol"
                                                   attrs="{'invisible':[('type','!=','in')],'readonly':[('protocollo_fields_editability','=',False)]}"/>
                                        </group>
                                        <group/>
                                    </group>
                                </div>
                            </div>

                            <div class="dati-protocollo-container" id="documento-container">
                                <div class="protocollo-accordion-toggle open">
                                    <h4 class="accordion-toggle">Documento</h4>
                                </div>
                                <div class="accordion-content accordion-open">
                                     <group>
                                        <div class="oe_edit_only">
                                            <button name="%(protocollo_modify_action)d" string="Modifica Dati" type="action"
                                                attrs="{'invisible':[('modifica_dati_generali_visibility','=',False)]}"
                                                class="oe_highlight_positive btn_seedoo button-form-protocollo btn_modifica_protocollo"/>
                                        </div>
                                    </group>
                                    <group col="8">
                                        <group>
                                            <field name="typology"
                                                   domain="[('is_visible','=',True)]"
                                                   attrs="{'invisible' : [('type','not in',('in','out'))], 'readonly':[('typology_editability','=',False)]}"
                                                   on_change="on_change_typology(typology)"
                                                   options="{'no_quick_create': True, 'no_create_edit' : True, 'no_open': True, 'no_create': True}"
                                                   context="{'tree_view_ref': 'seedoo_protocollo.protocollo_typology_tree_selection', 'type': type, 'mail_pec_ref': mail_pec_ref}"
                                            />
                                            <field name="receiving_date" attrs="{'invisible':[('type','!=','in')], 'readonly':[('protocollo_fields_editability','=',False)]}" class="seedoocustom_protocollo_receiving_date"/>
                                            <field name="subject" attrs="{'required':[('state','!=','draft')], 'readonly':[('protocollo_fields_editability','=',False)]}" class="protocollo_oggetto"/>
                                            <field name="doc_content" filename="doc_fname" attrs="{'invisible':[('doc_id','=',False)]}"/>
                                            <field name="doc_description" attrs="{'invisible':[('doc_id','=',False)]}"/>
                                            <newline/>
                                            <group colspan="2">
                                                <div class="oe_edit_only">
                                                    <button string="Carica Documento" type="action" class="oe_inline oe_highlight_positive oe_button btn_seedoo btn_carica_documenti button-form-protocollo"
                                                        attrs="{'invisible':[('carica_documento_visibility','=',False)]}"
                                                        name="%(protocollo_carica_documenti_wizard_action)d"/>
                                                    <newline/>
                                                    <button string="Modifica Documento" type="action" class="oe_inline oe_highlight_positive oe_button btn_seedoo btn_carica_documenti button-form-protocollo"
                                                        attrs="{'invisible':[('modifica_documento_visibility','=',False)]}"
                                                        name="%(protocollo_carica_documenti_wizard_action)d"/>
                                                    <field name="mimetype" invisible="1"/>
                                                </div>
                                            </group>
                                        </group>
                                        <group>
                                            <div class="emailpec-container">
                                                <group>
                                                    <field name="fingerprint" attrs="{'invisible':['|', ('registration_date','=',False),('doc_id','=',False)]}" readonly="1"
                                                           class="seedoocustom_protocollo_fingerprint"/>
                                                    <field name="server_sharedmail_id" options="{'no_quick_create': True, 'no_create_edit' : True, 'no_open': True}" attrs="{'invisible':['|',('sharedmail','!=',True),('type','=','in')],
                                                                                                    'required': [('server_sharedmail_id_required','=',True)], 'readonly':[('protocollo_fields_editability','=',False)]}"
                                                           class="seedoocustom_protocollo_server_sharedmail_id"/>
                                                    <field name="server_pec_id" options="{'no_quick_create': True, 'no_create_edit' : True, 'no_open': True}" attrs="{'invisible':['|',('pec','!=',True),('type','=','in')],
                                                                                                        'required': [('server_pec_id_required','=',True)], 'readonly':[('protocollo_fields_editability','=',False)]}"
                                                           class="seedoocustom_protocollo_server_pec_id"/>
                                                    <field name="body" attrs="{'invisible':['|','|',('type','=','in'),('inserisci_testo_mailpec_visibility','=',False),'&amp;',('sharedmail','=',False),('pec','=',False)],'readonly':[('protocollo_fields_editability','=',False)]}"
                                                           class="seedoocustom_protocollo_body"/>
                                                </group>
                                            </div>
                                        </group>
                                    </group>
                                </div>
                            </div>

                            <div class="dati-protocollo-container" id="anteprima-container"
                                 attrs="{'invisible':[('mimetype','!=','application/pdf'),('mimetype','not in',['image/png','image/jpeg','image/gif'])]}">
                                <div class="protocollo-accordion-toggle button-form-protocollo">
                                    <h4 class="accordion-toggle">Anteprima</h4>
                                </div>
                                <div class="accordion-content">
                                    <group attrs="{'invisible':[('mimetype','!=','application/pdf')]}">
                                        <field name="preview" noupload="True"
                                           nolabel="1"
                                           options="{'uploadbutton':false}"
                                           attrs="{'readonly':True}"
                                           widget="pdfviewer"
                                        />
                                    </group>
                                    <group attrs="{'invisible':[('mimetype','not in',['image/png','image/jpeg','image/gif'])]}">
                                        <field name="preview_image" noupload="True"
                                           nolabel="1"
                                           attrs="{'readonly':True}"
                                           widget="image"
                                           class="oe_avatar oe_avatar_protocollo"
                                        />
                                    </group>
                                </div>
                            </div>

                        </div>

                        <group>
                            <field name="user_id" readonly="1" options="{'no_open': True}" invisible="1"/>
                        </group>

                        <notebook class="protocollo_form_tabs">
                            <page string="Destinatari" attrs="{'invisible':[('type','!=','out')]}" class="tab-destintari tab-sr">
                                <group col="4" colspan="4">
                                    <div class="oe_form_buttons">
                                        <button name="crea_destinatario"
                                                string="Aggiungi Destinatario"
                                                type="object"
                                                attrs="{'invisible':[('aggiungi_destinatari_visibility','=',False)]}"
                                                class="oe_highlight_positive oe_edit_only btn_seedoo oe_kanban_button_new aggiungi_destinatario"
                                        />
                                        <button name="%(protocollo_create_destinatari_da_gruppo_wizard_action)d"
                                                string="Aggiungi Destinatari da Gruppo"
                                                type="action"
                                                attrs="{'invisible':[('aggiungi_destinatari_visibility','=',False)]}"
                                                class="oe_highlight_positive oe_edit_only btn_seedoo oe_kanban_button_new"
                                        />
                                    </div>
                                    <newline/>
                                    <field name="receivers" mode="kanban" nolabel="1" class="container_sr" attrs="{'readonly':[('modifica_destinatari_visibility','=',False)]}" colspan="4"/>
                                </group>
                            </page>
                            <page string="Mittente" attrs="{'invisible':[('type','=','in')]}" class="tab-mittente tab-internal tab-sr">
                                <div class="oe_edit_only">
                                    <button name="%(protocollo_aggiungi_sender_internal_action)d"
                                            string="Aggiungi Mittente"
                                            type="action"
                                            attrs="{'invisible':[('aggiungi_mittente_interno_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_aggiungi_assegnatari"/>
                                    <newline/>
                                    <button name="%(protocollo_aggiungi_sender_internal_action)d"
                                            string="Modifica Mittente"
                                            type="action"
                                            attrs="{'invisible':[('modifica_mittente_interno_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_modifica_assegnatari"/>
                                </div>
                                <div class="box-sender-internal" attrs="{'invisible':[('sender_internal_name','=', False)]}">
                                    <table class="oe_kanban_table">
                                        <tr>
                                            <td align="left" valign="middle">
                                                <div class="icon_item_type">
                                                   <div class="individual" attrs="{'invisible':[('sender_internal_employee','=',False)]}">
                                                        <span>Tipo</span>
                                                    </div>
                                                    <div class="legal" attrs="{'invisible':[('sender_internal_department','=',False)]}">
                                                        <span>Tipo</span>
                                                    </div>

                                                    <field name="sender_internal_department" invisible="1"/>
                                                    <field name="sender_internal_employee" invisible="1"/>
                                                </div>
                                            </td>
                                            <td class="sender_internal_name">
                                                <field name="sender_internal_name" nolabel="1" readonly="1"/>
                                            </td>
                                        </tr>
                                    </table>

                                    <button name="action_remove_sender_internal"
                                            context="{'protocollo_id': active_id}"
                                            string="x"
                                            type="object"
                                            attrs="{'invisible':[('modifica_mittente_interno_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_rimuovi_mittente oe_edit_only"/>
                                </div>
                            </page>
                            <page string="Mittente" attrs="{'invisible':[('type','!=','in')]}" class="tab-mittente tab-sr">
                                <group col="4" colspan="4">
                                    <div class="oe_form_buttons">
                                        <button name="crea_mittente"
                                                string="Aggiungi Mittente"
                                                type="object"
                                                attrs="{'invisible':[('aggiungi_mittenti_visibility','=',False)]}"
                                                class="oe_highlight_positive oe_edit_only btn_seedoo oe_kanban_button_new aggiungi_mittente"
                                        />
                                    </div>
                                    <newline/>
                                    <field name="senders" mode="kanban" nolabel="1" attrs="{'readonly':[('modifica_mittenti_visibility','=',False)]}" colspan="4"/>
                                </group>
                            </page>
                            <!--<page string="Preview" attrs="{'invisible':[('mimetype','!=','application/pdf')]}">-->
                                <!--<field name="preview" noupload="True"-->
                                       <!--nolabel="1"-->
                                       <!--options="{'uploadbutton':false}"-->
                                       <!--attrs="{'readonly':True}"-->
                                       <!--widget="pdfviewer"/>-->
                            <!--</page>-->
                            <page string="Classificazione">
                                <group col="4">
                                    <div class="oe_edit_only container_classification_header">
                                        <button name="%(protocollo_aggiungi_classificazione_action)d"
                                                string="Aggiungi Classificazione"
                                                type="action"
                                                attrs="{'invisible':[('aggiungi_classificazione_visibility','=',False)]}"
                                                class="oe_highlight_positive btn_seedoo btn_aggiungi_classificazione"
                                                context="{'initial_mode':'edit'}"
                                        />
                                        <newline/>
                                        <button name="%(protocollo_aggiungi_classificazione_action)d"
                                                string="Modifica Classificazione"
                                                type="action"
                                                attrs="{'invisible':[('modifica_classificazione_visibility','=',False)]}"
                                                class="oe_highlight_positive btn_seedoo btn_modifica_classificazione"
                                                context="{'initial_mode':'edit'}"
                                        />
                                    </div>
                                    <newline/>
                                    <field name="classification_name" nolabel="1" readonly="1" colspan="4" class="container_classification"
                                           attrs="{'invisible':['|',('classification','=', False)]}" />
                                    <field name="classification" invisible="1"/>
                                </group>
                            </page>
                            <page string="Assegnatari" id="page-assegnatari">
                                <div class="oe_edit_only">
                                    <button name="%(protocollo_aggiungi_assegnatari_action)d"
                                            string="Aggiungi Assegnatari"
                                            type="action"
                                            attrs="{'invisible':[('aggiungi_assegnatari_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_aggiungi_assegnatari"
                                            context="{'assegnatari_initial_state':assegnazione_first_level_ids, 'initial_mode':'edit'}"
                                    />
                                    <button name="%(protocollo_aggiungi_assegnatari_action)d"
                                            string="Modifica Assegnatari"
                                            type="action"
                                            attrs="{'invisible':[('modifica_assegnatari_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_modifica_assegnatari"
                                            context="{'assegnatari_initial_state':assegnazione_first_level_ids, 'call_by_modifica_assegnatari': True, 'initial_mode':'edit'}"
                                    />
                                    <button name="%(protocollo_aggiungi_assegnatari_cc_action)d"
                                            string="Aggiungi Assegnatari Conoscenza"
                                            type="action"
                                            attrs="{'invisible':[('aggiungi_assegnatari_cc_visibility','=',False)]}"
                                            class="oe_highlight_positive btn_seedoo btn_aggiungi_assegnatari_cc"
                                            context="{'assegnatari_initial_state':assegnazione_first_level_ids}"
                                    />
                                </div>

                                <group col="4">
                                    <field name="assegnazione_first_level_ids" nolabel="1" colspan="4"/>
                                </group>
                            </page>
                            <page string="Fascicoli">
                                <group col="4">
                                    <div class="oe_edit_only container_fascicolazione_header">
                                        <button name="%(protocollo_aggiungi_fascicolazione_action)d"
                                                string="Aggiungi Fascicolazione"
                                                type="action"
                                                attrs="{'invisible':[('aggiungi_fascicolazione_visibility','=',False)]}"
                                                class="oe_highlight_positive btn_seedoo btn_aggiungi_fascicolazione"
                                                context="{'initial_mode':'edit'}"
                                        />
                                        <newline/>
                                        <button name="%(protocollo_aggiungi_fascicolazione_action)d"
                                                string="Modifica Fascicolazione"
                                                type="action"
                                                attrs="{'invisible':[('modifica_fascicolazione_visibility','=',False)]}"
                                                class="oe_highlight_positive btn_seedoo btn_modifica_fascicolazione"
                                                context="{'initial_mode':'edit'}"
                                        />
                                    </div>
                                    <newline/>
                                    <field name="dossier_ids" nolabel="1" readonly="1"
                                           widget="many2many_kanban"
                                           options="{'limit': 10, 'no_create': True}"
                                           domain="[('state','=','open')]"
                                           colspan="4"
                                           class="protocollo_dossier_container">
                                        <kanban>
                                            <field name="name"/>
                                            <field name="classification_id" />
                                            <templates>
                                                <t t-name="kanban-box">
                                                    <div class="oe_kanban_box_content oe_kanban_color_bglight oe_kanban_color_border item_box" >
                                                        <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 5px; padding: 0 4px; display: inline-block;background: rgba(255,255,255,0.6);">X</a>
                                                        <a type="open" class="protocollo_dossier_box">
                                                            <table class="oe_kanban_table">
                                                                <tr>
                                                                    <td>
                                                                        <h6 class="dossier_title">
                                                                            <field name="dossier_typology"/>
                                                                        </h6>
                                                                        <h3>
                                                                            <field name="name"/>
                                                                        </h3>
                                                                        <p>
                                                                            <i class="fa fa-sitemap" aria-hidden="true"></i>
                                                                            <field name="classification_id"/>
                                                                        </p>

                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </a>
                                                    </div>
                                                </t>
                                            </templates>
                                        </kanban>
                                    </field>
                                </group>
                            </page>
                            <page string="Allegati" class="tab-allegati">
                                <group col="4" colspan="4">
                                    <div class="oe_edit_only">
                                        <button string="Carica Allegati" type="action" class="oe_inline oe_highlight_positive oe_button btn_seedoo btn_carica_documenti button-form-protocollo"
                                                    attrs="{'invisible':[('carica_allegati_visibility','=',False)]}"
                                                    name="%(protocollo_carica_allegati_wizard_action)d"/>
                                    </div>
                                    <field name="attachment_ids" colspan="4" widget="many2many_kanban" nolabel="1" class="container_allegati">
                                    <kanban quick_create="false" create="false">
                                        <field name="type"/>
                                        <field name="name"/>
                                        <field name="datas_description"/>
                                        <field name="is_main"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <t t-if="!record.is_main.raw_value">
                                                    <a type="open" class="protocollo_attachments_box">
                                                        <div class="oe_kanban_box_content oe_kanban_color_bglight oe_kanban_color_border item_box" >
                                                            <table class="oe_kanban_table">
                                                                <tr>
                                                                    <td class="oe_kanban_messaggio pec_button_col" align="left" valign="middle">
                                                                        <div class="icon_item_type">
                                                                           <div t-att-class="record.type.raw_value">
                                                                               <i class="fa fa-paperclip" aria-hidden="true"></i>
                                                                           </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <h3><field name="name"/></h3>
                                                                        <t t-if="record.datas_description.raw_value">
                                                                            <p>
                                                                                <field name="datas_description" />
                                                                            </p>
                                                                        </t>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </a>
                                                </t>
                                            </t>
                                        </templates>
                                    </kanban>
                                    <!--<tree default_order='is_main' string="is_main" fonts="bold:is_main==True;">-->
                                        <!--<field name="name" string="Nome"/>-->
                                        <!--<field name="datas_description"/>-->
                                        <!--&lt;!&ndash;<field name="user_id"/>&ndash;&gt;-->
                                        <!--<field name="is_main"/>-->
                                    <!--</tree>-->
                                </field>
                                </group>
                            </page>
                            <page string="Altro">
                                <field name="notes" nolabel="1" attrs="{'readonly':[('protocollo_fields_editability','=',False)]}" colspan="4"/>
                            </page>
                            <!--<page string="Segnatura XML"-->
                                  <!--groups="base.group_system">-->
                                <!--<label for="fingerprint"/>-->
                                <!--<field name="fingerprint" readonly="1" colspan="4"/>-->
                                <!--<newline/>-->
                                <!--<label for="xml_signature"/>-->
                                <!--<field name="xml_signature" readonly="1" colspan="4"/>-->
                            <!--</page>-->
                        </notebook>

                        <div class="oe_chatter oe_protocollo_chatter">
                            <field name="message_follower_ids" widget="mail_followers"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </div>

                    </sheet>

                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_protocollo_tree'>
            <field name="name">protocollo.protocollo.tree</field>
            <field name="model">protocollo.protocollo</field>
            <field name="arch" type="xml">
                <tree string="Protocolli" version="7.0" create="0" default_order="registration_date desc, create_date desc"
                      colors="#7c7bad:state=='registered';green:pec_notifications_sum=='True';green:state=='notified';green:state=='sent';orange:state=='waiting';red:state=='canceled';red:state=='error';">
                    <field name="type"/>
                    <field name="name"/>
                    <field name="sender_receivers" invisible="1"/>
                    <field name="registration_date_from" invisible="1"/>
                    <field name="registration_date_to" invisible="1"/>
                    <field name="registration_date"/>
                    <field name="registration_employee_name"/>
                    <field name="senders_summary"/>
                    <field name="receivers_summary"/>
                    <field name="subject"/>
                    <field name="typology"/>
                    <field name="state"/>
                    <field name="pec_notifications_ids" invisible="1"/>
                    <field name="pec_notifications_sum" invisible="1"/>
                </tree>
            </field>
        </record>


        <record model="ir.ui.view" id="protocollo_protocollo_search">
            <field name="name">protocollo.protocollo.search</field>
            <field name="model">protocollo.protocollo</field>
            <field name="arch" type="xml">
                <search string="Protocolli">
                    <field name="type" />
                    <field name="name"
                           filter_domain="[('name','ilike',self)]"
                           string="Numero Protocollo"/>
                    <field name="user_id"/>
                    <field name="sender_receivers"
                           filter_domain="['|', ('sender_internal_name', 'ilike', self), '&amp;', ('sender_receivers.name', 'ilike', self), ('sender_receivers.source', '=', 'sender')]"
                           string="Mittente"/>
                    <field name="sender_receivers"
                           filter_domain="[('sender_receivers.name', 'ilike', self), ('sender_receivers.source', '=', 'receiver')]"
                           string="Destinatario"/>
                    <field name="sender_receivers"
                           string="Mittente E-mail"
                           filter_domain="[('sender_receivers.email', 'ilike', self), ('sender_receivers.source', '=', 'sender')]"/>
                    <field name="sender_receivers"
                           string="Destinatario E-mail"
                           filter_domain="[('sender_receivers.email', 'ilike', self), ('sender_receivers.source', '=', 'receiver')]"/>
                    <field name="sender_receivers"
                           string="Mittente PEC"
                           filter_domain="[('sender_receivers.pec_mail', 'ilike', self), ('sender_receivers.source', '=', 'sender')]"/>
                    <field name="sender_receivers"
                           string="Destinatario PEC"
                           filter_domain="[('sender_receivers.pec_mail', 'ilike', self), ('sender_receivers.source', '=', 'receiver')]"/>
                    <field name="subject"/>
                    <field name="registration_date_from"
                           filter_domain="[('registration_date','&gt;=',self)]"
                           string="Registrato dopo il"/>
                    <field name="registration_date_in"
                           filter_domain="[('registration_date','&gt;=',self),('registration_date','&lt;=',self)]"
                           string="Registrato il"/>
                    <field name="registration_date_to"
                           filter_domain="[('registration_date','&lt;=',self)]"
                           string="Registrato entro il"/>
                    <field name="receiving_date_from"
                           filter_domain="[('receiving_date','&gt;=',self)]"
                           string="Ricevuto dopo il"/>
                    <field name="receiving_date_to"
                           filter_domain="[('receiving_date','&lt;=',self)]"
                           string="Ricevuto entro il"/>
                    <field name="doc_id" string="Documento (Nome)"/>
                    <field name="doc_description" string="Documento (Descrizione)"/>
                    <field name="doc_id"
                           string="Documento (contenuto)"
                           filter_domain="[('doc_id.index_content', 'ilike', self)]"/>
                    <field name="attachment_ids"
                           string="Allegati Nome file"
                           filter_domain="[('attachment_ids.name', 'ilike', self),
                                           ('attachment_ids.is_main', '=', False)]"/>
                    <field name="attachment_ids"
                           string="Allegati Descrizione"
                           filter_domain="[('attachment_ids.datas_description', 'ilike', self),
                                           ('attachment_ids.is_main', '=', False)]"/>
                    <field name="assegnazione_competenza_ids"
                           string="Assegnatario Dipendente Competenza"
                           filter_domain="[('filtro_assegnazione_competenza_dipendente_ids', 'ilike', self)]"/>
                    <field name="assegnazione_competenza_ids"
                           string="Assegnatario Ufficio Competenza"
                           filter_domain="[('filtro_assegnazione_competenza_ufficio_ids', 'ilike', self)]"/>
                    <field name="assegnazione_conoscenza_ids"
                           string="Assegnatario Dipendente CC"
                           filter_domain="[('filtro_assegnazione_conoscenza_dipendente_ids', 'ilike', self)]"/>
                    <field name="assegnazione_conoscenza_ids"
                           string="Assegnatario Ufficio CC"
                           filter_domain="[('filtro_assegnazione_conoscenza_ufficio_ids', 'ilike', self)]"/>
                    <field name="classification_name" string="Titolario" filter_domain="[('classification_name', 'ilike', self)]"/>
                    <field name="notes"/>
                    <field name="typology"/>
                    <field name="dossier_ids" string="Fascicolo"/>
                    <field name="state"/>
                    <separator/>
                    <group string="Tipo">
                        <filter string="Ingresso" name="in" domain="[('type','=','in')]"/>
                        <filter string="Uscita" name="out" domain="[('type','=','out')]"/>
                        <filter string="Emergenza" name="emergenza" domain="[('registration_type','=','emergency')]"/>
                    </group>
                    <group string="Mezzo">
                        <filter string="E-mail" name="sharedmail" domain="[('sharedmail','=',True)]"/>
                        <filter string="PEC" name="pec" domain="[('pec','=',True)]"/>
                        <filter string="Altro" name="pec" domain="[('pec','=',False), ('sharedmail','=',False)]"/>
                    </group>
                    <group string="Registrati">
                        <filter string="Da me" name="registrato_da_me" domain="[('user_id','=',uid),('registration_date','!=',False)]"/>
                    </group>
                    <group string="Data">
                        <filter string="Ieri" name="registered_yesterday" domain="
                         [('registration_date','&gt;',(context_today()-relativedelta(days=1)).strftime('%Y-%m-%d 00:00:00')),('registration_date','&lt;=',(context_today()-relativedelta(days=1)).strftime('%Y-%m-%d 23:59:59'))]"/>
                        <filter string="Oggi" name="registered_today" domain="
                        [('registration_date','&gt;',(context_today()).strftime('%Y-%m-%d 00:00:00')),('registration_date','&lt;=',(context_today()).strftime('%Y-%m-%d 23:59:59'))]"/>
                    </group>
                    <group string="Workflow">
                        <filter string="Senza Documento" name="senza_documento" domain="[('doc_id','=',False)]"/>
                        <filter string="Annullati" name="annullati" domain="[('state','=','canceled')]"/>
                        <filter string="Da Classificare" name="non_classificato" domain="[('state','in',('registered','notified','sent','waiting','error')),('classification','=',False)]"/>
                        <filter string="Da Fascicolare" name="non_fascicolato" domain="[('state','in',('registered','notified','sent','waiting','error','acts')),('dossier_ids','=',False)]"/>
                        <filter string="Da Assegnare" name="da_assegnare" domain="[('da_assegnare_general_visibility','=',True)]"/>
                        <filter string="Da Mettere agli Atti" name="da_mettere_agli_atti" domain="[('da_mettere_agli_atti_general_visibility','=',True)]"/>
                    </group>
                    <group string="PEC">
                        <filter string="Da inviare" name="to_sent" domain="[('type','=','out'),('pec','=',True),('state','=','registered')]"/>
                        <filter string="In attesa di ricevute" name="waiting" domain="[('state','=','waiting')]"/>
                        <filter string="In errore" name="error" domain="[('state','=','error')]"/>
                        <filter string="Consegnate" name="delivered" domain="[('type','=','out'),('receivers.pec_messaggio_ids.accettazione_ref','!=',False),('receivers.pec_messaggio_ids.consegna_ref','!=',False),'|',('state','=','sent'),('state','=','acts')]"/>
                    </group>
                    <group string="Assegnati">
                        <filter string="A me per Competenza" name="filtro_a_me_competenza" domain="[('filtro_a_me_competenza_visibility', '=', True)]"/>
                        <filter string="A me per CC" name="filtro_a_me_conoscenza" domain="[('filtro_a_me_conoscenza_visibility', '=', True)]"/>
                        <filter string="Al mio Ufficio per Competenza" name="filtro_a_mio_ufficio_visibility" domain="[('filtro_a_mio_ufficio_visibility', '=', True)]"/>
                        <filter string="Al mio Ufficio per CC" name="filtro_a_mio_ufficio_cc_visibility" domain="[('filtro_a_mio_ufficio_cc_visibility', '=', True)]"/>
                        <filter string="Da me" name="filtro_da_me" domain="[('filtro_da_me_visibility', '=', True)]"/>
                    </group>
                    <group string="Assegnazioni">
                        <!--
                        <filter string="In attesa" name="filtro_in_attesa" domain="[('filtro_in_attesa_visibility', '=', True)]"/>
                        <filter string="preso" name="filtro_preso_in_carico" domain="[('filtro_preso_in_carico_visibility', '=', True)]"/>
                        <filter string="rifiutato" name="filtro_rifiutato" domain="[('filtro_rifiutato_visibility', '=', True)]"/>
                        -->
                        <filter string="In Attesa di Presa in Carico" name="filtro_in_attesa" domain="[('in_attesa', '=', True)]"/>
                        <filter string="Prese in Carico" name="filtro_preso_in_carico" domain="[('preso', '=', True)]"/>
                        <filter string="Rifiutate" name="filtro_rifiutato" domain="[('rifiutato', '=', True)]"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="protocollo_protocollo_graph" model="ir.ui.view">
            <field name="name">protocollo.protocollo.graph</field>
            <field name="model">protocollo.protocollo</field>
            <field name="arch" type="xml">
                <graph string="Statistiche Protocolli" type="bar">
                    <field name="registration_date"/>
                </graph>
            </field>
        </record>

        <!--
        <record model="ir.actions.act_window" id="crea_protocollo_ingresso_action">
            <field name="name">Crea Protocollo in Ingresso</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="protocollo_protocollo_form"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="context">{'default_type':'in'}</field>
        </record>
        -->

        <record model="ir.actions.act_window" id="protocollo_protocollo_act">
            <field name="name">Registrati</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('registration_date','!=',False)] </field>
            <field name="context">{'is_current_archive': True}</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_protocollo_draft_act">
            <field name="name">Bozze</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('state','=','draft')]</field>
            <field name="context">{}</field>
        </record>

        <!--
        <record model="ir.actions.act_window" id="crea_protocollo_uscita_action">
            <field name="name">Crea Protocollo in Uscita</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="protocollo_protocollo_form"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="context">{'default_type':'out'}</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_protocollo_out_draft_others_act">
            <field name="name">Richieste protocollo</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('type','=','out'),('state','=','draft'),('protocol_request','=',True)]</field>
            <field name="context">{'default_type':'out'}</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_protocollo_notified_act">
            <field name="name">Registrati</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('state','in',('registered','notified','sent','waiting','error'))]</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_protocollo_not_classified_act">
            <field name="name">Non Classificati</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('state','in',('registered','notified','sent','waiting','error')),('classification','=',False),('user_id', '=', uid)]</field>
        </record>

        <record model="ir.actions.act_window" id="protocollo_protocollo_not_dossier_act">
            <field name="name">Non Fascicolati</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('state','in',('registered','notified','sent','waiting','error')),('dossier_ids','=',False)]</field>
        </record>
        -->

        <record model="ir.actions.act_window" id="protocollo_protocollo_archiviati_act">
            <field name="name">Archiviati</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="protocollo_protocollo_tree"/>
            <field name="search_view_id" ref="protocollo_protocollo_search"/>
            <field name="domain">[('registration_date','!=',False)] </field>
            <field name="context">{'is_current_archive': False}</field>
        </record>

        <!-- Browse Classification -->
        <record model="ir.actions.act_window" id="action_protocollo_protocollo_classification">
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">protocollo.protocollo</field>
            <field name="name">Protocolli da Titolario</field>
            <field name="view_type">form</field>
            <field name="domain">[('classification','in',[active_id])]</field>
        </record>

        <record model="ir.actions.act_window" id="action_protocollo_configuration_classification">
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">protocollo.classification</field>
            <field name="name">Titolario</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="protocollo_classification_tree2"/>
            <field name="domain">[('parent_id','=',False)]</field>
        </record>

        <record model="ir.values" id="ir_action_protocollo_protocollo_classification_form">
            <field name="key2" eval="'tree_but_open'"/>
            <field name="model" eval="'protocollo.classification'"/>
            <field name="name">Naviga Titolario</field>
            <field name="value" eval="'ir.actions.act_window,%d'%action_protocollo_protocollo_classification"/>
        </record>


        <!-- Protocol Journal -->

        <record model='ir.ui.view' id='protocollo_journal_form'>
            <field name="name">protocollo.journal.form</field>
            <field name="model">protocollo.journal</field>
            <field name="arch" type="xml">
                <form string="Registro Giornaliero" create="0" edit="0">
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <field name="date"/>
                            <field name="user_id"/>
                            <notebook colspan="4">
                                <page string="Protocollazioni della Giornata" class="lista_protocolli">
                                    <field name="protocol_ids" colspan="4" nolabel="1"/>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_journal_tree'>
            <field name="name">protocollo.journal.tree</field>
            <field name="model">protocollo.journal</field>
            <field name="arch" type="xml">
                <tree string="Registro Giornaliero" version="7.0" create="0">
                    <field name="date"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_journal_search'>
            <field name="name">protocollo.journal.search</field>
            <field name="model">protocollo.journal</field>
            <field name="arch" type="xml">
                <search string="Registro Giornaliero">
                    <field name="date"/>
                </search>
            </field>
        </record>

        <record model='ir.actions.act_window' id='protocollo_journal_act'>
            <field name="name">Registro Giornaliero</field>
            <field name="res_model">protocollo.journal</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- Protocol Emergency -->
        <record model='ir.ui.view' id='protocollo_emergency_registry_form'>
            <field name="name">protocollo.emergency.registry.form</field>
            <field name="model">protocollo.emergency.registry</field>
            <field name="arch" type="xml">
                <form string="Registro Emergenza" create="0" edit="0">
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="user_id"/>
                            <newline/>
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <separator string="Numeri Riservati e Protocollazioni" colspan="4"/>
                            <field name="emergency_ids" colspan="4" nolabel="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="emergency_number"/>
                                    <field name="protocol_id"/>
                                </tree>
                                <form>
                                    <field name="name"/>
                                    <field name="emergency_number"/>
                                    <field name="protocol_id"/>
                                </form>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_emergency_registry_tree'>
            <field name="name">protocollo.emergency.registry.tree</field>
            <field name="model">protocollo.emergency.registry</field>
            <field name="arch" type="xml">
                <tree string="Registro Emergenza" version="7.0" create="0">
                    <field name="name"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model='ir.ui.view' id='protocollo_emergency_registry_search'>
            <field name="name">protocollo.emergency.registry.search</field>
            <field name="model">protocollo.emergency.registry</field>
            <field name="arch" type="xml">
                <search string="Registro Emergenza">
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record model='ir.actions.act_window'
                id='protocollo_emergency_registry_act'>
            <field name="name">Registro Emergenza</field>
            <field name="res_model">protocollo.emergency.registry</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record id="action_server_clona_protocollo" model="ir.actions.server">
            <field name="name">Copia dati</field>
            <field name="type">ir.actions.server</field>
            <field name="state">code</field>
            <field name="model_id" ref="model_protocollo_protocollo" />
            <field name="code">action = self.action_clona_protocollo(cr, uid, context.get('active_ids', []), context)</field>
        </record>

       <record model="ir.values" id="ir_values_action_server_clona_protocollo">
           <field name="key2" eval="'client_action_relate'"/>
           <field name="model" eval="'protocollo.protocollo'"/>
           <field name="name">Copia dati</field>
           <field name="value" eval="'ir.actions.server,%d'%action_server_clona_protocollo"/>
       </record>

        <!-- Assegnatari Ufficio -->
        <!--
        <record model="ir.ui.view" id="protocollo_assegnatario_ufficio_form">
            <field name="name">protocollo.assegnatario.ufficio.form</field>
            <field name="model">protocollo.assegnatario.ufficio</field>
            <field name="arch" type="xml">
                <form string="Uffici Assegnatari">
                    <sheet>
                        <group col="4">
                            <field name="department_id"/>
                            <field name="protocollo_id"/>
                            <field name="tipo"/>
                            <newline/>
                            <separator string="Dipendenti Ufficio Assegnatari" colspan="4"/>
                            <field name="assegnatari_dipendenti_ids" colspan="4"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="protocollo_assegnatario_ufficio_tree">
            <field name="name">protocollo.assegnatario.ufficio.tree</field>
            <field name="model">protocollo.assegnatario.ufficio</field>
            <field name="arch" type="xml">
                <tree string="Ufficio Assegnatario">
                    <field name="department_id"/>
                    <field name="protocollo_id"/>
                    <field name="tipo"/>
                </tree>
            </field>
        </record>
        -->


        <!-- Assegnatari Dipedente -->
        <!--
        <record model="ir.ui.view" id="protocollo_assegnatario_dipendente_form">
            <field name="name">protocollo.assegnatario.dipendente.form</field>
            <field name="model">protocollo.assegnatario.dipendente</field>
            <field name="arch" type="xml">
                <form string="Dipendenti Assegnatari">
                    <sheet>
                        <group col="4">
                            <field name="dipendente_id"/>
                            <field name="state"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="protocollo_assegnatario_dipendente_tree">
            <field name="name">protocollo.assegnatario.dipendente.tree</field>
            <field name="model">protocollo.assegnatario.dipendente</field>
            <field name="arch" type="xml">
                <tree string="Dipendente Assegnatario" colors="green:state=='preso';red:state=='rifiutato'">
                    <field name="dipendente_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        -->

        <template id="journal_qweb">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="report.external_layout">
                        <div class="page">
                            <style type="text/css">
                                table th {color: #0D5C63 !important; text-transform:uppercase; }
                                h3, h3 span {color:#666 !important;}
                                h4, h4 span {color:#999 !important;}
                            </style>
                            <p>
                                <img t-if="o.user_id.company_id.logo" t-att-src="'data:image/png;base64,%s' %o.user_id.company_id.logo"/>
                            </p>
                            <h3>Registro Giornaliero -
                                <span t-field="o.user_id.company_id.name"/>
                            </h3>
                            <h4>Registro di protocollo del
                                <strong><span t-field="o.date"/></strong>
                            </h4>
                            <table style="width:100%;font-size: 10px;">
                                <tr style="padding: 5px; border: 1px solid #aaa;height: 30px; background-color: #f0f0f0">
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="5%">Tipo
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="5%">Registro
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="5%">Numero
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="10%">Data
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="20%">Oggetto
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="20%">Impronta
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="20%">Mittente/Destinatario
                                    </th>
                                    <th style="padding: 2px 5px 2px 2px;"
                                        width="15%">Prot. Mittente
                                    </th>
                                </tr>
                                <t t-foreach="o.protocol_ids" t-as="protocol">
                                    <tr style="padding: 5px; border: 1px solid #aaa;height: 30px">
                                        <td width="5%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.type"/>
                                        </td>
                                        <td width="5%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.registry"/>
                                        </td>
                                        <td width="5%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.name"/>
                                        </td>
                                        <td width="10%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.registration_date"/>
                                        </td>
                                        <td width="20%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.subject"/>
                                        </td>
                                        <td width="20%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-field="protocol.fingerprint"/>
                                        </td>
                                        <td width="20%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <t t-foreach="protocol.sender_receivers"
                                               t-as="sr">
                                                <span t-field="sr.name"/>
                                                <br/>
                                            </t>
                                        </td>
                                        <td width="15%"
                                            style="padding: 2px 5px 2px 2px;">
                                            <span t-if="protocol.sender_protocol" t-field="protocol.sender_protocol"/> del <span t-field="protocol.sender_registration_date"/>
                                        </td>
                                    </tr>
                                </t>
                            </table>
                        </div>
                    </t>
                </t>
            </t>
        </template>

    </data>
</openerp>

